$schema: "https://json-schema.org/draft/2020-12/schema"
title: "Data Product Table Configuration Schema"
type: object
required:
  - table
properties:
  table:
    type: object
    required:
      - name
      - desription_detail
      - metadata_tags
      - data_model_tags
    properties:
      name:
        type: string

      # -----------------------------
      # Description
      # -----------------------------
      
      desription_detail:
        type: object
        required:
          - description
          - granularity
          - data_contract
          - dev_data_pipeline
          - prod_data_pipeline
          - data_product_github
          - slo
        properties:
          description:
            type: string
          data_spec:
            type: string
            format: uri
          granularity:
            type: string
          data_contract:
            type: string
            format: uri
          dev_data_pipeline:
            type: string
            format: uri
          prod_data_pipeline:
            type: string
            description: "Prod pipeline URI"
            format: uri
          data_product_github:
            type: string
            format: uri

          # -----------------------------
          # SLO SCHEMA
          # -----------------------------
          slo:
            type: object
            description: "SLO schedule definition for data pipeline execution"
            required:
              - type
              - timezone
            properties:
              type:
                type: string
                enum:
                  - every_n_hours
                  - daily
                  - custom
             
              timezone:
                type: string
                description: "IANA timezone, e.g., UTC, Europe/London"
                examples: ["UTC"]

              start:
                type: string
                description: "Start time for interval schedules, HH:MM"
                pattern: "^[0-2][0-9]:[0-5][0-9]$"

              interval_hours:
                type: integer
                minimum: 1
                maximum: 24
                description: "Used only when type = every_n_hours"

              times:
                type: array
                description: "Explicit run times for daily or custom schedules"
                items:
                  type: string
                  pattern: "^[0-2][0-9]:[0-5][0-9]$"
                minItems: 1
                uniqueItems: true

            allOf:
              - if:
                  properties:
                    type:
                      const: every_n_hours
                then:
                  required:
                    - start
                    - interval_hours
              - if:
                  properties:
                    type:
                      const: daily
                then:
                  required:
                    - times
              - if:
                  properties:
                    type:
                      const: custom
                then:
                  required:
                    - times

      # -----------------------------
      # METADATA TAGS
      # -----------------------------
      metadata_tags:
        type: object
        required:
          - data_owner
          - data_category
          - data_classification
          - business_criticality
          - sox_scope
          - ooh_support
          - retention_period
        properties:
          data_owner:
            type: string
          data_category:
            type: string
            enum:
              - business_analytical_data
              - operational_data
              - pii
              - other
          data_classification:
            type: string
            enum:
              - internal
              - confidential
          business_criticality:
            type: string
            enum: ["p0", "p1", "p2", "p3"]
          sox_scope:
            type: boolean
          ooh_support:
            type: boolean
          retention_period:
            type: string
            description: "Human-readable retention period, e.g., '7 years'"

      # -----------------------------
      # DATA MODEL TAGS
      # -----------------------------
      data_model_tags:
        type: object
        required:
          - nk
        properties:
          nk:
            type: string
            description: "Natural key specification"