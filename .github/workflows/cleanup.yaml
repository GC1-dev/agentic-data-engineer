name: Cleanup
on:
  push:
    branches:
      - clean_up_dab

permissions:
  contents: read
  id-token: write
  pull-requests: write
  actions: read

jobs:
  CleanupDAB:
    name: Cleanup Databricks Asset Bundle
    uses: skyscanner/reusable-workflows/.github/workflows/databricks-asset-bundles.yaml@v3
    secrets: inherit
    with:
      runs-on: ubuntu-latest-small
      databricks-runtime-version: 16.4
      service-principal-application-id: bcfc93d0-4c4a-460c-851f-4eb6e5fcec01
      databricks-workspace: dev
      delete-dab: true

      # Delete all .bundle files before running DAB cleanup
      install-commands: |
        echo "Deleting all bundle directories under .bundle/..."
        databricks workspace delete -r /Workspace/Users/bcfc93d0-4c4a-460c-851f-4eb6e5fcec01/.bundle || echo "Already deleted or not found"
        echo "âœ“ All bundle files cleaned up"
      dry-run: false